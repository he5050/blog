<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H+ 添加文章</title>
    <meta name="keywords" content="H+">
    <meta name="description" content="H">

    <link rel="shortcut icon" href="__HOME__favicon.ico">
    <link href="__HOME__css/bootstrap.min.css" rel="stylesheet">
    <link href="__HOME__css/font-awesome.css" rel="stylesheet">
    <link href="__HOME__css/animate.css" rel="stylesheet">
    <link href="__HOME__css/style.css" rel="stylesheet">
    <link href="__HOME__css/plugins/chosen/chosen.css" rel="stylesheet">
    <link href="__HOME__css/plugins/sweetalert/sweetalert.css" rel="stylesheet">
    <style type="text/css">
        .ue{
            height: 500px;
        }
    </style>

</head>

<body class="gray-bg">
    <div class="wrapper wrapper-content animated fadeInRight">
        <div class="row">
            <div class="col-sm-12 ">
                <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        <a class="text-info" title="点击我刷新"><h5>添加文章</h5><i class="fa fa-refresh fa-spin"></i></a>
                        <div class="ibox-tools">
                            <a class="collapse-link">
                                <i class="fa fa-chevron-up"></i>
                            </a>
                            <a class="dropdown-toggle" data-toggle="dropdown" href="form_basic.html#">
                                <i class="fa fa-wrench"></i>
                            </a>
                            <ul class="dropdown-menu dropdown-user">
                                <li><a href="form_basic.html#">选项1</a>
                                </li>
                                <li><a href="form_basic.html#">选项2</a>
                                </li>
                            </ul>
                            <a class="close-link">
                                <i class="fa fa-times"></i>
                            </a>
                        </div>
                    </div>
                    <div class="ibox-content">
                        <form class="form-horizontal m-t" id="arti" action="{:url('home/article/add')}" method="post" enctype="multipart/form-data">
                            <div class="form-group">
                                <label class="col-sm-2 control-label">文章标题*</label>
                                <div class="col-sm-8">
                                    <input id="title" name="title" class="form-control" type="text">
                                    <span class="help-block m-b-none"><i class="fa fa-info-circle"></i>请输入文章标题</span>
                                </div>
                            </div>
                            <div class="hr-line-dashed"></div>
                            <div class="form-group">
                             <label class="col-sm-2 control-label">文章简介*</label>
                                <div class="col-sm-8 ">
                                    <input id="subhead" name="subhead" class="form-control" type="text">
                                    <span class="help-block m-b-none"><i class="fa fa-info-circle"></i>文章简介</span>
                                </div>
                            </div>
                            <div class="form-group">
                             <label class="col-sm-2 control-label">文章状态*</label>
                                <div class="col-sm-8 ">
                                    <label class="radio-inline"><input type="checkbox" name="status[]" value="1">精华</label>
                                    <label class="radio-inline"><input type="checkbox" name="status[]" value="2">热门</label>
                                    <label class="radio-inline"><input type="checkbox" name="status[]" value="3">美图</label>
                                    <label class="radio-inline"><input type="checkbox" name="status[]" value="4">优秀</label>
                                    <label class="radio-inline"><input type="checkbox" name="status[]" value="5">置顶</label>
                                    <label class="radio-inline"><input type="checkbox" name="status[]" value="6">推荐</label>
                                    <label class="radio-inline"><input type="checkbox" name="status[]" value="7" checked>原创</label>
                                    <label class="radio-inline"><input type="checkbox" name="status[]" value="8">爆料</label>
                                    <span class="help-block m-b-none"><i class="fa fa-info-circle"></i>推荐 优秀 原创</span>
                                </div>
                            </div>    
                            <div class="hr-line-dashed"></div>
                            <div class="form-group">
                                <label class="col-sm-2 control-label">文章内容</label>
                                <div class="col-sm-8 ue">
                                         <!-- 加载编辑器的容器 -->
                                        <script id="container" name="content" type="text/plain" style="height:400px">编辑内容</script>
                                </div>
                            </div>
                            <div class="hr-line-dashed"></div>
                            <div class="form-group">
                             <label class="col-sm-2 control-label">标签</label>
                                <div class="col-sm-8">
                                    <input id="tags" name="tags" class="form-control" type="text">
                                    <span class="help-block m-b-none"><i class="fa fa-info-circle"></i>文章标签如:{volist name="tags" id="tag"}<a>{$tag.tag}</a>,{/volist}</span>
                                </div>
                            </div>
                            <div class="hr-line-dashed"></div>
                            <div class="form-group">
                             <label class="col-sm-2 control-label">是否公开</label>
                                <div class="col-sm-8">
                                    <input type="radio" value="1" checked name="isshow">公开
                                    <input type="radio" value="0" name="isshow">私密
                                </div>
                            </div> 
                            <div class="hr-line-dashed"></div>
                            <div class="form-group">
                             <label class="col-sm-2 control-label">是否添加水印</label>
                                <div class="col-sm-8">
                                    <input type="radio" value="1" name="iswater">是
                                    <input type="radio" value="0" name="iswater" checked>否
                                </div>
                            </div>
                            <div class="form-group">
                             <label class="col-sm-2 control-label">是否推荐阅读</label>
                                <div class="col-sm-8">
                                    <input type="radio" value="1" name="recommend">是
                                    <input type="radio" value="0" name="recommend" checked>否
                                </div>
                            </div> 
                            <div class="hr-line-dashed"></div>
                            <div class="form-group">
                             <label class="col-sm-2 control-label">文章分类</label>
                                <div class="col-sm-8">
                                    <select name="cate" id="">
                                        {volist name="cates" id="cate"}
                                            <option value="{$cate.id}">{$cate.lev|str_repeat='&nbsp;&nbsp;',###}{$cate.c_name}</option>
                                        {/volist}
                                    </select>
                                </div>
                            </div>        
                            <div class="hr-line-dashed"></div>
                            <div class="form-group">
                                <div class="col-sm-8 col-sm-offset-3">
                                    <button id="sub" class="btn btn-primary" type="submit" disabled="disabled"><span id="s">添加</span></button>
                                    <button class="btn btn-primary" type="button" onclick="window.location.href='{:url('home/article/list')}'">返回</button>
                                </div>
                            </div>
                            <input type="hidden" value="0" id='imgs' name="imgs">
                            <input type="hidden" value="0" id='files' name="files">
                        </form>
                    </div>
                </div>
            </div>
        </div>

    </div>


    <!-- 全局js -->
    <script src="__HOME__js/jquery.min.js"></script>
    <script src="__HOME__js/bootstrap.min.js"></script>

    <!-- 自定义js -->
    <script src="__HOME__js/content.js"></script>
    <script src="__HOME__js/plugins/sweetalert/sweetalert.min.js"></script>
    {js href="__HOME__js/jquery.form.js" /}
    <script src="__HOME__js/dropzone.min.js"></script>    
<!--    ue插件-->
    <script type="text/javascript" charset="utf-8" src="__HOME__plugins/Uedit/ueditor.config.js"></script>
    <script type="text/javascript" charset="utf-8" src="__HOME__plugins/Uedit/ueditor.all.min.js"> </script>
    <!--建议手动加在语言，避免在ie下有时因为加载语言失败导致编辑器加载失败-->
    <!--这里加载的语言文件会覆盖你在配置项目里添加的语言类型，比如你在配置项目里配置的是英文，这里加载的中文，那最后就是中文-->
    <script type="text/javascript" charset="utf-8" src="__HOME__plugins/Uedit/lang/zh-cn/zh-cn.js"></script>
    <script type="text/javascript">
        var ue = UE.getEditor('container',{
            autoHeightEnabled: false,
            autoFloatEnabled: false,
        });
        $('#s').mouseover(function(){
            var title = $.trim($('#title').val());
            var subhead = $.trim($('#subhead').val());
            var content = ue.getContent();
            var imgs = '';
            var file = '';
            //获取上传图片地址
            $(content).find('img').each(function(i){
                var s = $(this).attr('src');
                if(s.indexOf('upload') > -1){
                    imgs += s + ',';
                }
                
            });
            //获取文件的上传地址
            $(content).find('a').each(function(i){
                var f = $(this).attr('href');
                if(f.indexOf('upload') > -1){
                    file += f + ',';
                }
            })
            if(title != '' && subhead !='' && content != ''){
                $(this).parent().prop('disabled',false);
                $('#imgs').val(imgs);
                $('#files').val(file);
            }
        });
        $(".m-b-none a").click(function(){
            //获取标签input当中的值
            var tags = $('#tags').val();
            //获取标签
            var tag = $(this).text();
            if(tags == ''){
               $('#tags').val(tag);
            }else{
                $('#tags').val(tags+','+tag);
            }
        });
        (function(){
          var options = {success : showInfo};
          $('#arti').ajaxForm(options);
          function showInfo(msg){
             if(msg.status == 1){
                    swal({
                        title: "恭喜您发表文章成功!",
                        text: "您成功的发表了文章,即将跳转到文章列表页面",
                        type: "success"
                    },function(){
                        //跳转到
                        window.location.href="{:url('home/article/list')}";
                    });
                }else{
                   swal({
                        title: "好像出了点什么问题!",
                        text: "请您重新在试试",
                        type: "warning",
                        confirmButtonColor: "#DD6B55",
                        confirmButtonText: "发表文章失败!",
                        closeOnConfirm: false,
                        closeOnCancel: false
                    });
                }
          }  
      })();
    </script>
</body>

</html>