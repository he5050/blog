<!DOCTYPE html>
<html>

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">


    <title>H+ 编辑用户</title>
    <meta name="keywords" content="H+">
    <meta name="description" content="H+">

    <link rel="shortcut icon" href="__HOME__favicon.ico">
    <link href="__HOME__css/bootstrap.min.css" rel="stylesheet">
    <link href="__HOME__css/font-awesome.css" rel="stylesheet">
    <link href="__HOME__css/plugins/iCheck/custom.css" rel="stylesheet">
    <link href="__HOME__css/animate.css" rel="stylesheet">
    <link href="__HOME__css/style.css" rel="stylesheet">
    <link href="__HOME__css/plugins/sweetalert/sweetalert.css" rel="stylesheet">
    <link href="__HOME__css/plugins/chosen/chosen.css" rel="stylesheet">

</head>

<body class="gray-bg">
    <div class="wrapper wrapper-content animated fadeInRight">
        <div class="row">
            <div class="col-sm-12 ">
                <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        <a class="text-info" title="点击我刷新"><h5>用户资料<small>编辑用户的详细信息</small></h5><i class="fa fa-refresh fa-spin"></i></a>
                        <div class="ibox-tools">
                            <a class="collapse-link">
                                <i class="fa fa-chevron-up"></i>
                            </a>
                            <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                                <i class="fa fa-wrench"></i>
                            </a>
                            <ul class="dropdown-menu dropdown-user">
                                <li><a href="#">选项1</a>
                                </li>
                                <li><a href="#">选项2</a>
                                </li>
                            </ul>
                            <a class="close-link">
                                <i class="fa fa-times"></i>
                            </a>
                        </div>
                    </div>
                    <div class="ibox-content">
                        <form method="post" class="form-horizontal" id="user" action="{:url('home/user/edit')}">
                            <div class="form-group">
                                <label class="col-sm-2 control-label">用户名</label>

                                <div class="col-sm-10">
                                    <input name="username" type="text" class="form-control" value="{$userInfo.u_name}">
                                    <input name="userid" type="hidden" readonly="readonly" value="{$userInfo.u_id}">
                                    <span class="help-block m-b-none">用户的登录名</span>
                                </div>
                            </div>
                            <div class="hr-line-dashed"></div>
                            <div class="form-group">
                                <label class="col-sm-2 control-label">新密码</label>
                                <div class="col-sm-10">
                                    <input type="password" name="password" class="form-control"> <span class="help-block m-b-none">如果继续使用原密码,请留空</span>
                                </div>
                            </div>
                            <div class="hr-line-dashed"></div>
                            <div class="form-group">
                                <label class="col-sm-2 control-label">重复新密码</label>

                                <div class="col-sm-10">
                                    <input type="password" class="form-control" name="rpassword">
                                </div>
                            </div>
                            <div class="hr-line-dashed"></div>
                            <div class="form-group">
                                <label class="col-sm-2 control-label">用户真实姓名</label>

                                <div class="col-sm-10">
                                    <input type="text" placeholder="提示信息" class="form-control" value="{$userInfo.u_rel_name}" name="userrname">
                                    <span class="help-block m-b-none">姓名</span>
                                </div>
                            </div>
                            <div class="hr-line-dashed"></div>
                            <div class="form-group">
                                <label class="col-sm-2 control-label">用户昵称</label>

                                <div class="col-sm-10">
                                    <input type="text" placeholder="提示信息" class="form-control" value="{$userInfo.u_sname}" name="usersname">
                                    <span class="help-block m-b-none">用户昵称</span>
                                </div>
                            </div>
                            <div class="hr-line-dashed"></div>
                            <div class="form-group">
                                <label class="col-sm-2 control-label">手机号</label>

                                <div class="col-sm-10">
                                    <input type="text" placeholder="提示信息" class="form-control" value="{$userInfo.u_mobile}" name="userphone">
                                    <span class="help-block m-b-none">手机号</span>
                                </div>
                            </div>
                            <div class="hr-line-dashed"></div>
                            <div class="form-group">
                                <label class="col-sm-2 control-label">邮箱</label>

                                <div class="col-sm-10">
                                    <input type="text" placeholder="提示信息" class="form-control" value="{$userInfo.u_email}" name="useremail">
                                    <span class="help-block m-b-none">邮箱</span>
                                </div>
                            </div>

                           <div class="hr-line-dashed"></div>
                            <div class="form-group">
                                <label class="col-sm-2 control-label">身份证</label>

                                <div class="col-sm-10">
                                    <input type="text" placeholder="提示信息" class="form-control" value="{$userInfo.u_card}" name="usercard">
                                    <span class="help-block m-b-none">身体证号</span>
                                </div>
                            </div>
                            <div class="hr-line-dashed"></div>
                            <div class="form-group">
                                <label class="col-sm-2 control-label">姓别</label>

                                <div class="col-sm-10">
                                   <div class="radio">
                                        <label>
                                            <input type="radio" checked="" value="1" id="optionsRadios1" name="sex"
                                            {if condition="$userInfo.u_gender eq 1"}
                                            checked
                                            {/if}
                                            >男</label>
                                    </div>
                                    <div class="radio">
                                        <label>
                                            <input type="radio" value="2" id="optionsRadios2" name="sex"
                                             {if condition="$userInfo.u_gender eq 0"}
                                            checked
                                            {/if}
                                            >女</label>
                                    </div>
                                </div>
                            </div>
                            <div class="hr-line-dashed"></div>
                            <div class="form-group">
                                <label class="col-sm-2 control-label">选择省市区</label>

                                <div class="col-sm-10">
                                    <div class="col-sm-10">

                                        <div class="col-sm-3">
                                            <select data-placeholder="选择地区..." class="chosen-select" tabindex="2" name="a1" id="a1" type="text">

                                                {volist name="area1" id="vo1"}
                                                <option hassubinfo="true" value="{$vo1.charArea}"
                                                {if condition="$vo1.charArea eq $userInfo.u_from"}
                                                    selected
                                                {/if}
                                                >{$vo1.charArea}--{$vo1.charAreaen}</option>
                                                {/volist}
                                            </select>
                                        </div>
                                        <div class="col-sm-2">
                                            <select data-placeholder="选择省市..." class="chosen-select" tabindex="2" name="a2" id="a2" type="text">
                                                 {volist name="area2" id="vo2"}
                                                <option hassubinfo="true" value="{$vo2.charProvince}"
                                                {if condition="$vo2.charProvince eq $userInfo.u_province"}
                                                    selected
                                                {/if}
                                                >{$vo2.charProvince}--{$vo2.charShortProvince}</option>
                                                {/volist}
                                            </select>
                                        </div>
                                        <div data-placeholder="选择区县..." class="chosen-select" tabindex="2" class="col-sm-2">
                                            <select name="a3" id="a3" type="text">
                                             {volist name="area3" id="vo3"}
                                                <option hassubinfo="true" value="{$vo3.charCity}"
                                                {if condition="$vo3.charCity eq $userInfo.u_city"}
                                                    selected
                                                {/if}
                                                >{$vo3.charCity}--{$vo3.charCityen}</option>
                                                {/volist}
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-2 control-label">详细地址</label>

                                <div class="col-sm-10">
                                    <div class="col-sm-10">
                                        <input type="text" placeholder="提示信息" class="form-control" value="{$userInfo.u_area}" id="areainfo" name="areainfo">
                                        <span class="help-block m-b-none">请输入您的详细地址</span>
                                    </div>
                                </div>
                            </div>
                            <div class="hr-line-dashed"></div>
                            <div class="form-group">
                                <div class="col-sm-4 col-sm-offset-2">
                                    <button class="btn btn-primary" type="submit">保存内容</button>
                                    <button class="btn btn-primary" type="button" onclick="window.location.href='{:url('home/user/list')}'">返回</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 全局js -->
    <script src="__HOME__js/jquery.min.js"></script>
    <script src="__HOME__js/bootstrap.min.js"></script>

    <!-- 自定义js -->
    <script src="__HOME__js/content.js"></script>

    <!-- iCheck -->
    <script src="__HOME__js/plugins/iCheck/icheck.min.js"></script>
    <script src="__HOME__js/plugins/sweetalert/sweetalert.min.js"></script>
    <script src="__HOME__js/plugins/validate/jquery.validate.min.js"></script>
    <script src="__HOME__js/plugins/validate/messages_zh.min.js"></script>
    <script src="__HOME__js/demo/form-validate-demo.js"></script>
     {js href="__HOME__js/jquery.form.js" /}
    <script>
        $(document).ready(function () {
            $('.i-checks').iCheck({
                checkboxClass: 'icheckbox_square-green',
                radioClass: 'iradio_square-green',
            });
        });
       (function(){
           $("select").change(function () {
               console.log('111');
                var a1 = $("#a1").val();
                var a2 = $("#a2").val();
                var a3 = $('#a3').val();
               if(a1 && a2 && a3){
                   var area =$("#areainfo").val();
                   if(area && area != undefined){
                       var all = area.split('----');
                       if(all[1]){
                           $("#areainfo").val(a1+'-'+a2+'-'+a3+'----'+all[1]);
                       }else{
                           $("#areainfo").val(a1+'-'+a2+'-'+a3+'----'+'');
                       }
                   }
               }
        });
            //二级联动
        $('#a1').change(function(){
            var area = $(this).val();
            $.post("{:url('home/user/add')}",{info:1,area:area},function(msg){
                //取得省市JQ对象
                var sel2 = $('#a2');
                //清空
                sel2.empty();
                //添加顶级分类
                sel2.append(new Option('请选择省市'));
                $(msg).each(function(i){
                    var ll = msg[i].charProvince + '--' + msg[i].charShortProvince;
                    //添加获取到的省市信息
                    var op = new Option(ll,msg[i].charProvince);
                    sel2.append(op);
                });
            },'json');
        });
       //三级联动
        $('#a2').change(function(){
            var area = $(this).val();
            $.post("{:url('home/user/add')}",{info:2,area:area},function(msg){
                //取得省市JQ对象
                var sel3 = $('#a3');
                //清空
                sel3.empty();
                //添加顶级分类
                sel3.append(new Option('请选择区县'));
                $(msg).each(function(i){
                    var ll = msg[i].charCity + '--' + msg[i].charCityen;
                    //添加获取到的省市信息
                    var op = new Option(ll,msg[i].charCity);
                    sel3.append(op);
                });
            },'json');
        });
          var options = {success : showInfo};
          $('#user').ajaxForm(options);
          function showInfo(msg){
             if(msg.status == 1){
                    swal({
                        title: "修改用户成功!",
                        text: "您成功修改了用户,请刷新后查看",
                        type: "success"
                    },function(){
                        //刷新当前页面
                         window.location.reload();
                    });
                }else{
                   swal({
                        title: "好像出了点什么问题!",
                        text: "请您重新在试试",
                        type: "warning",
                        confirmButtonColor: "#DD6B55",
                        confirmButtonText: "修改用户失败!",
                        closeOnConfirm: false,
                        closeOnCancel: false
                    });
                }
          }  
      })();
    </script>
    
</body>

</html>